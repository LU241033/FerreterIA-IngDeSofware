<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Actualizar Producto | FerreterIA</title>

  <!-- Estilos -->
  <link rel="stylesheet" href="/css/actualizar-producto.css">
  <link rel="stylesheet" href="/css/style.css">

  <!-- Icono -->
  <link rel="shortcut icon" href="../../img/Logo.png" type="image/x-icon">
</head>

<body>
  <!-- ======= HEADER ======= -->
  <header class="barra-navegacion">
    <div class="contenedor">
      <div class="logo">FerreterIA</div>
      <ul class="enlaces">
        <li><a href="../../Index.html">Inicio</a></li>
        <li><a href="../usuario/explora.html">Explora</a></li>
        <li><a href="#">Compras</a></li>
        <li><a href="#">Perfil</a></li>
        <li><a href="panel-admin.html">Gesti√≥n Productos</a></li>
      </ul>

      <div class="botones" id="botonesAuth">
        <button class="btn-borde" onclick="location.href='../Login.html'">Iniciar sesi√≥n</button>
        <button class="btn-principal" onclick="location.href='../usuario/registro.html'">Registrarse</button>
      </div>
    </div>
  </header>

  <!-- ======= CONTENIDO PRINCIPAL ======= -->
  <section class="seccion-principal">
    <div class="contenido-principal">
      <div class="encabezado-formulario">
        <h2>Actualizar Producto üî©</h2>
        <p>Modifica los datos de un producto existente en el inventario.</p>
      </div>

      <div class="formulario-contenedor">
        <div id="mensaje-formulario" style="display:none; margin-bottom: 15px; padding: 12px; border-radius: 8px;"></div>
        <form id="formActualizarProducto">
          <div class="grupo-formulario">
            <label for="id-producto">ID del producto:</label>
            <input type="text" id="id-producto" placeholder="Ej. 001" required readonly>
            <span class="icono-input">üîç</span>
            <small style="color: #666; display: block; margin-top: 5px;">El ID no se puede modificar</small>
          </div>
          
          <div class="grupo-formulario">
            <label for="nuevo-nombre">Nombre del producto:</label>
            <input type="text" id="nuevo-nombre" placeholder="Ej. Martillo reforzado" required>
            <span class="icono-input">üìù</span>
          </div>
          
          <div class="grupo-formulario">
            <label for="nueva-categoria">Categor√≠a:</label>
            <input type="text" id="nueva-categoria" placeholder="Ej. Herramientas manuales" required>
            <span class="icono-input">üìÇ</span>
          </div>
          
          <div class="grupo-formulario">
            <label for="nuevo-precio">Precio:</label>
            <input type="number" id="nuevo-precio" step="0.01" min="0" placeholder="Ej. 30000" required>
            <span class="icono-input">üí∞</span>
          </div>
          
          <div class="grupo-formulario">
            <label for="nuevo-stock">Cantidad en stock:</label>
            <input type="number" id="nuevo-stock" min="0" placeholder="Ej. 15" required>
            <span class="icono-input">üì¶</span>
          </div>
          
          <button type="submit" class="boton-formulario boton-principal">Actualizar Producto</button>
          <button type="button" class="boton-formulario boton-volver" onclick="location.href='panel-admin.html'">
            ‚Üê Volver a Gesti√≥n
          </button>
        </form>
      </div>
    </div>
  </section>

  <!-- ======= FOOTER ======= -->
  <footer class="pie-pagina">
    <div class="contenedor-pie">
      <div>
        <h4>FerreterIA</h4>
        <p>Tu socio de confianza para soluciones seguras y eficientes.</p>
      </div>

      <div>
        <h4>Enlaces r√°pidos</h4>
        <ul>
          <li><a href="/html/index.html">Inicio</a></li>
          <li><a href="/html/usuario/explora.html">Explora</a></li>
          <li><a href="/html/comunes/acerca-de-nosotros.html">Acerca de</a></li>
        </ul>
      </div>

      <div>
        <h4>Servicios</h4>
        <ul>
          <li>Gesti√≥n de productos</li>
          <li>Reportes</li>
          <li>Control de inventario</li>
        </ul>
      </div>

      <div>
        <h4>Cont√°ctanos</h4>
        <p>Email: info@ferreteria.com<br>Tel: 312-XXX-XXXX</p>
      </div>
    </div>
    <p class="copy">&copy; 2025 FerreterIA. Todos los derechos reservados.</p>
  </footer>

  <!-- Scripts -->
  <script src="../../js/utils.js"></script>
  <script src="../../js/productos.js"></script>
  <script>
    // Verificar autenticaci√≥n de admin
    document.addEventListener("DOMContentLoaded", () => {
      if (!protegerRutaAdmin()) return;
      actualizarBotonesAuth();

      // Obtener ID de la URL
      const urlParams = new URLSearchParams(window.location.search);
      const idProducto = urlParams.get('id');

      if (!idProducto) {
        mostrarMensaje('No se especific√≥ un ID de producto', 'error');
        setTimeout(() => {
          window.location.href = 'panel-admin.html';
        }, 2000);
        return;
      }

      // Cargar producto
      const producto = gestorProductos.obtenerPorId(idProducto);
      
      if (!producto) {
        mostrarMensaje('Producto no encontrado', 'error');
        setTimeout(() => {
          window.location.href = 'panel-admin.html';
        }, 2000);
        return;
      }

      // Llenar formulario con datos del producto
      document.getElementById('id-producto').value = producto.id;
      document.getElementById('nuevo-nombre').value = producto.nombre;
      document.getElementById('nueva-categoria').value = producto.categoria;
      document.getElementById('nuevo-precio').value = producto.precio;
      document.getElementById('nuevo-stock').value = producto.stock;

      // Manejar env√≠o del formulario
      const form = document.getElementById("formActualizarProducto");
      const mensajeDiv = document.getElementById("mensaje-formulario");

      form.addEventListener("submit", (e) => {
        e.preventDefault();

        const datosActualizados = {
          nombre: document.getElementById("nuevo-nombre").value.trim(),
          categoria: document.getElementById("nueva-categoria").value.trim(),
          precio: document.getElementById("nuevo-precio").value,
          stock: document.getElementById("nuevo-stock").value
        };

        // Validar
        const validacion = validarProducto({
          nombre: datosActualizados.nombre,
          categoria: datosActualizados.categoria,
          precio: datosActualizados.precio,
          stock: datosActualizados.stock
        });

        if (!validacion.valido) {
          mostrarMensajeEnFormulario(validacion.errores.join(", "), "error");
          return;
        }

        try {
          const productoActualizado = gestorProductos.actualizar(idProducto, datosActualizados);
          mostrarMensajeEnFormulario(`‚úÖ Producto "${productoActualizado.nombre}" actualizado exitosamente`, "success");
          
          // Redirigir despu√©s de 2 segundos
          setTimeout(() => {
            window.location.href = "panel-admin.html";
          }, 2000);
        } catch (error) {
          mostrarMensajeEnFormulario(`‚ùå Error: ${error.message}`, "error");
        }
      });

      function mostrarMensajeEnFormulario(mensaje, tipo) {
        mensajeDiv.textContent = mensaje;
        mensajeDiv.style.display = "block";
        mensajeDiv.style.backgroundColor = tipo === "success" ? "#10b981" : "#ef4444";
        mensajeDiv.style.color = "white";
        mensajeDiv.style.padding = "12px";
        mensajeDiv.style.borderRadius = "8px";
        mensajeDiv.style.marginBottom = "15px";
        
        setTimeout(() => {
          mensajeDiv.style.display = "none";
        }, 5000);
      }
    });
  </script>
</body>
</html>
