<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Eliminar Producto | FerreterIA</title>

  <link rel="shortcut icon" href="../../Img/Logo.png" type="image/x-icon">

  <link rel="stylesheet" href="../../css/acerca.css">
  <link rel="stylesheet" href="../../css/eliminar-producto.css">
</head>
<body>

  <header class="barra-navegacion">
    <div class="contenedor">
      <div class="logo">FerreterIA</div>
      <ul class="enlaces">
        <li><a href="../../inicio.html">Inicio</a></li>
        <li><a href="../usuario/tienda.html">Tienda</a></li>
        <li><a href="panel-admin.html">Panel Admin</a></li>
      </ul>
      <div class="botones" id="botonesAuth">
        <button class="btn-borde" onclick="location.href='../iniciar-sesion.html'">Iniciar sesi√≥n</button>
        <button class="btn-principal" onclick="location.href='../usuario/registro.html'">Registrarse</button>
      </div>
    </div>
  </header>

  <!-- SECCI√ìN PRINCIPAL -->
  <section class="seccion-principal">
    <div class="contenido-principal">
      <div class="encabezado-formulario">
        <h2>Eliminar Producto üóëÔ∏è</h2>
        <p>Busca el producto que deseas eliminar del inventario.</p>
      </div>

      <div class="formulario-contenedor">
        <div id="mensaje-formulario" style="display:none; margin-bottom: 15px; padding: 12px; border-radius: 8px;"></div>
        <div class="alerta-eliminacion">
          <p>‚ö†Ô∏è Esta acci√≥n no se puede deshacer. El producto se eliminar√° permanentemente.</p>
        </div>
        
        <div id="producto-info" style="display:none; margin-bottom: 20px; padding: 20px; background: #fef2f2; border: 2px solid #fecaca; border-radius: 8px;">
          <h3 style="color: #dc2626; margin-bottom: 15px;">Producto a Eliminar:</h3>
          <div id="producto-details" style="color: #7f1d1d;"></div>
        </div>
        
        <form id="formEliminarProducto">
          <div class="grupo-formulario">
            <label for="buscar-producto">ID del producto:</label>
            <input type="text" id="buscar-producto" placeholder="Ej. 001" required>
            <span class="icono-input">üîç</span>
            <button type="button" class="boton-buscar" onclick="buscarProductoParaEliminar()" style="margin-top: 10px; padding: 8px 16px; background: linear-gradient(135deg, #d97706 0%, #ea580c 100%); color: white; border: none; border-radius: 6px; cursor: pointer;">
              Buscar Producto
            </button>
          </div>
          
          <button type="submit" class="boton-formulario boton-peligro" id="btnEliminar" disabled>Eliminar Producto</button>
          <button type="button" class="boton-formulario boton-volver" onclick="location.href='panel-admin.html'">
            ‚Üê Volver a Gesti√≥n
          </button>
        </form>
      </div>
    </div>
  </section>

  <footer class="pie-pagina">
    <div class="contenedor-pie">
      <div>
        <h4>FerreterIA</h4>
        <p>Tu socio de confianza para soluciones seguras y eficientes.</p>
      </div>

      <div>
        <h4>Enlaces r√°pidos</h4>
        <ul>
          <li><a href="../../inicio.html">Inicio</a></li>
          <li><a href="../usuario/tienda.html">Tienda</a></li>
          <li><a href="../comunes/acerca-de-nosotros.html">Acerca de</a></li>
        </ul>
      </div>

      <div>
        <h4>Servicios</h4>
        <ul>
          <li>Gesti√≥n de productos</li>
          <li>Reportes</li>
          <li>Control de inventario</li>
        </ul>
      </div>

      <div>
        <h4>Cont√°ctanos</h4>
        <p>Email: info@ferreteria.com<br>Tel: 312-XXX-XXXX</p>
      </div>
    </div>

    <p class="copy">&copy; 2025 FerreterIA. Todos los derechos reservados.</p>
  </footer>

  <script src="../../js/utils.js"></script>
  <script src="../../js/productos.js"></script>
  <!-- Cargar l√≥gica espec√≠fica de administrador -->
  <script src="../../js/admin.js"></script>
  <script>
    // Variable global para almacenar el producto seleccionado
    let productoSeleccionado = null;

    // Inicializar la vista de administrador cuando se carga la p√°gina
    document.addEventListener("DOMContentLoaded", () => {
      // Inicializar vista de admin (verificaci√≥n de permisos, navegaci√≥n)
      inicializarVistaAdmin();

      // Obtener ID de la URL si existe (cuando se viene desde panel-admin.html)
      const urlParams = new URLSearchParams(window.location.search);
      const idProducto = urlParams.get('id');
      
      if (idProducto) {
        // Si hay un ID en la URL, buscar el producto autom√°ticamente
        document.getElementById('buscar-producto').value = idProducto;
        buscarProductoParaEliminar();
      }

      // Configurar el formulario de eliminaci√≥n
      const form = document.getElementById("formEliminarProducto");
      if (form) {
        form.addEventListener("submit", (e) => {
          e.preventDefault();
          eliminarProductoConfirmado();
        });
      }
    });

    /**
     * Buscar un producto para eliminar
     */
    function buscarProductoParaEliminar() {
      const idBuscar = document.getElementById('buscar-producto').value.trim();
      
      if (!idBuscar) {
        mostrarMensaje('Por favor, ingresa un ID de producto', 'warning');
        return;
      }

      const producto = gestorProductos.obtenerPorId(idBuscar);
      
      if (!producto) {
        mostrarMensaje('Producto no encontrado', 'error');
        document.getElementById('producto-info').style.display = 'none';
        document.getElementById('btnEliminar').disabled = true;
        productoSeleccionado = null;
        return;
      }

      // Almacenar el producto seleccionado
      productoSeleccionado = producto;
      
      // Mostrar informaci√≥n del producto
      const estadoStock = gestorProductos.obtenerEstadoStock(producto.stock);
      const precioFormateado = gestorProductos.formatearPrecio(producto.precio);

      document.getElementById('producto-details').innerHTML = `
        <p><strong>ID:</strong> #${producto.id}</p>
        <p><strong>Nombre:</strong> ${sanitizarTexto(producto.nombre)}</p>
        <p><strong>Categor√≠a:</strong> ${sanitizarTexto(producto.categoria)}</p>
        <p><strong>Precio:</strong> ${precioFormateado}</p>
        <p><strong>Stock:</strong> ${producto.stock} unidades</p>
        <p><strong>Estado:</strong> <span class="estado-stock ${estadoStock.clase}">${estadoStock.texto}</span></p>
      `;

      // Mostrar la informaci√≥n y habilitar el bot√≥n de eliminar
      document.getElementById('producto-info').style.display = 'block';
      document.getElementById('btnEliminar').disabled = false;
    }

    /**
     * Eliminar el producto despu√©s de confirmaci√≥n
     */
    function eliminarProductoConfirmado() {
      if (!productoSeleccionado) {
        mostrarMensaje('Primero debes buscar un producto', 'error');
        return;
      }

      // Confirmaci√≥n adicional
      const confirmacion = confirm(
        `¬øEst√°s seguro de eliminar el producto "${productoSeleccionado.nombre}" (ID: #${productoSeleccionado.id})?\n\nEsta acci√≥n no se puede deshacer.`
      );

      if (!confirmacion) {
        return;
      }

      try {
        // Eliminar el producto
        gestorProductos.eliminar(productoSeleccionado.id);
        
        // Mostrar mensaje de √©xito
        mostrarMensaje(`‚úÖ Producto "${productoSeleccionado.nombre}" eliminado exitosamente`, 'success');
        
        // Limpiar formulario
        const form = document.getElementById("formEliminarProducto");
        form.reset();
        productoSeleccionado = null;
        document.getElementById('producto-info').style.display = 'none';
        document.getElementById('btnEliminar').disabled = true;
        
        // Redirigir al panel de administraci√≥n despu√©s de 2 segundos
        setTimeout(() => {
          window.location.href = "panel-admin.html";
        }, 2000);
      } catch (error) {
        mostrarMensaje(`‚ùå Error: ${error.message}`, 'error');
      }
    }
  </script>
</body>
</html>
