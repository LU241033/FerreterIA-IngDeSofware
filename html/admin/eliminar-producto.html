<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Eliminar Producto | FerreterIA</title>

  <!-- Favicon -->
  <link rel="shortcut icon" href="../../Img/Logo.png" type="image/x-icon">

  <!-- CSS principal y espec√≠fico -->
  <link rel="stylesheet" href="../../css/acerca.css">
  <link rel="stylesheet" href="../../css/eliminar-producto.css">
</head>
<body>

  <!-- HEADER -->
  <header class="barra-navegacion">
    <div class="contenedor">
      <div class="logo">FerreterIA</div>
      <ul class="enlaces">
        <li><a href="../../index.html">Inicio</a></li>
        <li><a href="../usuario/explora.html">Explora</a></li>
        <li><a href="#">Compras</a></li>
        <li><a href="#">Perfil</a></li>
        <li><a href="panel-admin.html">Gesti√≥n Productos</a></li>
      </ul>
      <div class="botones" id="botonesAuth">
        <button class="btn-borde" onclick="location.href='../../login.html'">Iniciar sesi√≥n</button>
        <button class="btn-principal" onclick="location.href='../../registro.html'">Registrarse</button>
      </div>
    </div>
  </header>

  <!-- SECCI√ìN PRINCIPAL -->
  <section class="seccion-principal">
    <div class="contenido-principal">
      <div class="encabezado-formulario">
        <h2>Eliminar Producto üóëÔ∏è</h2>
        <p>Busca el producto que deseas eliminar del inventario.</p>
      </div>

      <div class="formulario-contenedor">
        <div id="mensaje-formulario" style="display:none; margin-bottom: 15px; padding: 12px; border-radius: 8px;"></div>
        <div class="alerta-eliminacion">
          <p>‚ö†Ô∏è Esta acci√≥n no se puede deshacer. El producto se eliminar√° permanentemente.</p>
        </div>
        
        <div id="producto-info" style="display:none; margin-bottom: 20px; padding: 20px; background: #fef2f2; border: 2px solid #fecaca; border-radius: 8px;">
          <h3 style="color: #dc2626; margin-bottom: 15px;">Producto a Eliminar:</h3>
          <div id="producto-details" style="color: #7f1d1d;"></div>
        </div>
        
        <form id="formEliminarProducto">
          <div class="grupo-formulario">
            <label for="buscar-producto">ID del producto:</label>
            <input type="text" id="buscar-producto" placeholder="Ej. 001" required>
            <span class="icono-input">üîç</span>
            <button type="button" class="boton-buscar" onclick="buscarProductoParaEliminar()" style="margin-top: 10px; padding: 8px 16px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer;">
              Buscar Producto
            </button>
          </div>
          
          <button type="submit" class="boton-formulario boton-peligro" id="btnEliminar" disabled>Eliminar Producto</button>
          <button type="button" class="boton-formulario boton-volver" onclick="location.href='panel-admin.html'">
            ‚Üê Volver a Gesti√≥n
          </button>
        </form>
      </div>
    </div>
  </section>

  <!-- FOOTER -->
  <footer class="pie-pagina">
    <div class="contenedor-pie">
      <div>
        <h4>FerreterIA</h4>
        <p>Tu socio de confianza para soluciones seguras y eficientes.</p>
      </div>

      <div>
        <h4>Enlaces r√°pidos</h4>
        <ul>
          <li><a href="../../index.html">Inicio</a></li>
          <li><a href="../usuario/explora.html">Servicios</a></li>
          <li><a href="../comunes/acerca-de-nosotros.html">Acerca de</a></li>
        </ul>
      </div>

      <div>
        <h4>Servicios</h4>
        <ul>
          <li>Gesti√≥n de productos</li>
          <li>Reportes</li>
          <li>Control de inventario</li>
        </ul>
      </div>

      <div>
        <h4>Cont√°ctanos</h4>
        <p>Email: info@ferreteria.com<br>Tel: 312-XXX-XXXX</p>
      </div>
    </div>

    <p class="copy">&copy; 2025 FerreterIA. Todos los derechos reservados.</p>
  </footer>

  <!-- Scripts -->
  <script src="../../js/utils.js"></script>
  <script src="../../js/productos.js"></script>
  <script>
    let productoSeleccionado = null;

    // Verificar autenticaci√≥n de admin
    document.addEventListener("DOMContentLoaded", () => {
      if (!protegerRutaAdmin()) return;
      actualizarBotonesAuth();

      // Obtener ID de la URL si existe
      const urlParams = new URLSearchParams(window.location.search);
      const idProducto = urlParams.get('id');
      
      if (idProducto) {
        document.getElementById('buscar-producto').value = idProducto;
        buscarProductoParaEliminar();
      }

      // Manejar env√≠o del formulario
      const form = document.getElementById("formEliminarProducto");
      const mensajeDiv = document.getElementById("mensaje-formulario");

      form.addEventListener("submit", (e) => {
        e.preventDefault();

        if (!productoSeleccionado) {
          mostrarMensajeEnFormulario('Primero debes buscar un producto', 'error');
          return;
        }

        // Confirmaci√≥n adicional
        const confirmacion = confirm(
          `¬øEst√°s seguro de eliminar el producto "${productoSeleccionado.nombre}" (ID: #${productoSeleccionado.id})?\n\nEsta acci√≥n no se puede deshacer.`
        );

        if (!confirmacion) {
          return;
        }

        try {
          gestorProductos.eliminar(productoSeleccionado.id);
          mostrarMensajeEnFormulario(`‚úÖ Producto "${productoSeleccionado.nombre}" eliminado exitosamente`, "success");
          
          // Limpiar formulario
          form.reset();
          productoSeleccionado = null;
          document.getElementById('producto-info').style.display = 'none';
          document.getElementById('btnEliminar').disabled = true;
          
          // Redirigir despu√©s de 2 segundos
          setTimeout(() => {
            window.location.href = "panel-admin.html";
          }, 2000);
        } catch (error) {
          mostrarMensajeEnFormulario(`‚ùå Error: ${error.message}`, "error");
        }
      });
    });

    function buscarProductoParaEliminar() {
      const idBuscar = document.getElementById('buscar-producto').value.trim();
      
      if (!idBuscar) {
        mostrarMensaje('Por favor, ingresa un ID de producto', 'warning');
        return;
      }

      const producto = gestorProductos.obtenerPorId(idBuscar);
      
      if (!producto) {
        mostrarMensajeEnFormulario('Producto no encontrado', 'error');
        document.getElementById('producto-info').style.display = 'none';
        document.getElementById('btnEliminar').disabled = true;
        productoSeleccionado = null;
        return;
      }

      productoSeleccionado = producto;
      const estadoStock = gestorProductos.obtenerEstadoStock(producto.stock);
      const precioFormateado = gestorProductos.formatearPrecio(producto.precio);

      document.getElementById('producto-details').innerHTML = `
        <p><strong>ID:</strong> #${producto.id}</p>
        <p><strong>Nombre:</strong> ${sanitizarTexto(producto.nombre)}</p>
        <p><strong>Categor√≠a:</strong> ${sanitizarTexto(producto.categoria)}</p>
        <p><strong>Precio:</strong> ${precioFormateado}</p>
        <p><strong>Stock:</strong> ${producto.stock} unidades</p>
        <p><strong>Estado:</strong> <span class="estado-stock ${estadoStock.clase}">${estadoStock.texto}</span></p>
      `;

      document.getElementById('producto-info').style.display = 'block';
      document.getElementById('btnEliminar').disabled = false;
    }

    function mostrarMensajeEnFormulario(mensaje, tipo) {
      const mensajeDiv = document.getElementById("mensaje-formulario");
      mensajeDiv.textContent = mensaje;
      mensajeDiv.style.display = "block";
      mensajeDiv.style.backgroundColor = tipo === "success" ? "#10b981" : "#ef4444";
      mensajeDiv.style.color = "white";
      mensajeDiv.style.padding = "12px";
      mensajeDiv.style.borderRadius = "8px";
      mensajeDiv.style.marginBottom = "15px";
      
      setTimeout(() => {
        mensajeDiv.style.display = "none";
      }, 5000);
    }
  </script>
</body>
</html>
