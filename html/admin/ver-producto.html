<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Consultar Producto | FerreterIA</title>

  <link rel="stylesheet" href="/css/consultar-producto.css">
  <link rel="stylesheet" href="/css/style.css">
  <link rel="shortcut icon" href="../../img/Logo.png" type="image/x-icon">
</head>

<body>
  <header class="barra-navegacion">
    <div class="contenedor">
      <div class="logo">FerreterIA</div>
      <ul class="enlaces">
        <li><a href="../../Index.html">Inicio</a></li>
        <li><a href="../usuario/tienda.html">Tienda</a></li>
        <li><a href="#">Compras</a></li>
        <li><a href="#">Perfil</a></li>
        <li><a href="panel-admin.html">Gesti√≥n Productos</a></li>
      </ul>
      <div class="botones" id="botonesAuth">
        <button class="btn-borde" onclick="location.href='../Login.html'">Iniciar sesi√≥n</button>
        <button class="btn-principal" onclick="location.href='../usuario/registro.html'">Registrarse</button>
      </div>
    </div>
  </header>

  <!-- ====== CONTENIDO PRINCIPAL ====== -->
  <section class="seccion-principal">
    <div class="contenido-principal">
      <div class="encabezado-formulario">
        <h2>Consultar Producto üîç</h2>
        <p>Busca y visualiza la informaci√≥n detallada de cualquier producto en el inventario.</p>
      </div>

      <div class="formulario-contenedor">
        <form id="formulario-consulta">
          <div class="grupo-formulario">
            <label for="tipo-busqueda">Buscar por:</label>
            <select id="tipo-busqueda">
              <option value="id">ID del Producto</option>
              <option value="nombre">Nombre del Producto</option>
              <option value="categoria">Categor√≠a</option>
            </select>
          </div>
          
          <div class="grupo-formulario">
            <label for="valor-busqueda">T√©rmino de b√∫squeda:</label>
            <input type="text" id="valor-busqueda" placeholder="Ej. Martillo, 001, Herramientas..." required>
            <span class="icono-input">üîé</span>
          </div>
          
          <button type="button" class="boton-formulario boton-principal" onclick="buscarProducto()">Buscar Producto</button>
          <button type="button" class="boton-formulario boton-volver" onclick="location.href='panel-admin.html'">
            ‚Üê Volver a Gesti√≥n
          </button>
        </form>

        <!-- Resultados de la b√∫squeda -->
        <div class="resultado-busqueda" id="resultado-busqueda">
          <h3 style="color: #2d3748; margin-bottom: 1rem;">Informaci√≥n del Producto</h3>
          <div class="tarjeta-producto" id="tarjeta-producto">
            <!-- Aqu√≠ se mostrar√°n los resultados -->
          </div>
        </div>

        <!-- Estado sin resultados -->
        <div class="sin-resultados" id="sin-resultados" style="display: none;">
          <div class="icono">üîç</div>
          <h3>No se encontraron productos</h3>
          <p>Intenta con otro t√©rmino de b√∫squeda o verifica la informaci√≥n.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- ====== FOOTER ====== -->
  <footer class="pie-pagina">
    <div class="contenedor-pie">
      <div>
        <h4>FerreterIA</h4>
        <p>Tu socio de confianza para soluciones seguras y eficientes.</p>
      </div>

      <div>
        <h4>Enlaces r√°pidos</h4>
        <ul>
          <li><a href="/html/index.html">Inicio</a></li>
          <li><a href="../usuario/tienda.html">Tienda</a></li>
          <li><a href="/html/comunes/acerca-de-nosotros.html">Acerca de</a></li>
        </ul>
      </div>

      <div>
        <h4>Servicios</h4>
        <ul>
          <li>Gesti√≥n de productos</li>
          <li>Reportes</li>
          <li>Control de inventario</li>
        </ul>
      </div>

      <div>
        <h4>Cont√°ctanos</h4>
        <p>Email: info@ferreteria.com<br>Tel: 312-XXX-XXXX</p>
      </div>
    </div>
    <p class="copy">&copy; 2025 FerreterIA. Todos los derechos reservados.</p>
  </footer>

  <!-- Scripts -->
  <script src="../../js/utils.js"></script>
  <script src="../../js/productos.js"></script>
  <script>
    // Verificar autenticaci√≥n de admin
    document.addEventListener("DOMContentLoaded", () => {
      if (!protegerRutaAdmin()) return;
      actualizarBotonesAuth();

      // Permitir b√∫squeda con Enter
      document.getElementById('valor-busqueda').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          e.preventDefault();
          buscarProducto();
        }
      });
    });

    function buscarProducto() {
      const tipoBusqueda = document.getElementById('tipo-busqueda').value;
      const valorBusqueda = document.getElementById('valor-busqueda').value.trim();
      const resultadoDiv = document.getElementById('resultado-busqueda');
      const tarjetaProducto = document.getElementById('tarjeta-producto');
      const sinResultados = document.getElementById('sin-resultados');
      
      if (!valorBusqueda) {
        mostrarMensaje('Por favor, ingresa un t√©rmino de b√∫squeda', 'warning');
        return;
      }
      
      // Buscar productos usando el gestor
      const productosEncontrados = gestorProductos.buscar(tipoBusqueda, valorBusqueda);
      
      if (productosEncontrados.length === 0) {
        resultadoDiv.style.display = 'none';
        sinResultados.style.display = 'block';
        return;
      }

      // Mostrar todos los productos encontrados (o solo el primero si es b√∫squeda por ID)
      let productosAMostrar = productosEncontrados;
      if (tipoBusqueda === 'id' && productosEncontrados.length > 0) {
        productosAMostrar = [productosEncontrados[0]]; // Solo mostrar el primero si es b√∫squeda por ID
      }

      let htmlResultados = '';
      
      productosAMostrar.forEach(producto => {
        const estadoStock = gestorProductos.obtenerEstadoStock(producto.stock);
        const precioFormateado = gestorProductos.formatearPrecio(producto.precio);
        
        htmlResultados += `
          <div class="info-producto" style="margin-bottom: 20px; padding: 20px; border: 1px solid #e2e8f0; border-radius: 8px;">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
              <div>
                <div class="campo-info"><div class="etiqueta">ID</div><div class="valor">#${producto.id}</div></div>
                <div class="campo-info"><div class="etiqueta">Nombre</div><div class="valor">${sanitizarTexto(producto.nombre)}</div></div>
                <div class="campo-info"><div class="etiqueta">Categor√≠a</div><div class="valor">${sanitizarTexto(producto.categoria)}</div></div>
              </div>
              <div>
                <div class="campo-info"><div class="etiqueta">Precio</div><div class="valor">${precioFormateado}</div></div>
                <div class="campo-info"><div class="etiqueta">Stock</div><div class="valor">${producto.stock}</div><div class="estado-stock ${estadoStock.clase}">${estadoStock.texto}</div></div>
                <div class="campo-info"><div class="etiqueta">Fecha Creaci√≥n</div><div class="valor">${new Date(producto.fechaCreacion).toLocaleDateString('es-CO')}</div></div>
              </div>
            </div>
            <div class="acciones-resultado" style="margin-top: 15px; display: flex; gap: 10px;">
              <a href="actualizar-producto.html?id=${producto.id}" class="boton-accion boton-editar">‚úèÔ∏è Actualizar</a>
              <a href="eliminar-producto.html?id=${producto.id}" class="boton-accion boton-eliminar">üóëÔ∏è Eliminar</a>
            </div>
          </div>
        `;
      });

      if (productosEncontrados.length > 1 && tipoBusqueda !== 'id') {
        htmlResultados = `<p style="margin-bottom: 15px; color: #666;">Se encontraron ${productosEncontrados.length} productos:</p>` + htmlResultados;
      }

      tarjetaProducto.innerHTML = htmlResultados;
      resultadoDiv.style.display = 'block';
      sinResultados.style.display = 'none';
    }
