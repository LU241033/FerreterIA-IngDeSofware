<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cat√°logo de Productos | FerreterIA</title>
  <link rel="stylesheet" href="../../css/style.css">
  <link rel="stylesheet" href="../../css/explora.css">
  <link rel="shortcut icon" href="../../img/FAVICON.ico" type="image/x-icon">
  <style>
    .catalogo-productos {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 25px;
      margin-top: 30px;
    }
    
    .tarjeta-producto {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      transition: transform 0.3s, box-shadow 0.3s;
      border: 1px solid #e2e8f0;
    }
    
    .tarjeta-producto:hover {
      transform: translateY(-5px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    
    .tarjeta-producto h3 {
      color: #2d3748;
      margin-bottom: 10px;
      font-size: 1.2em;
    }
    
    .tarjeta-producto .categoria {
      color: #718096;
      font-size: 0.9em;
      margin-bottom: 15px;
    }
    
    .tarjeta-producto .precio {
      font-size: 1.5em;
      font-weight: bold;
      color: #2b6cb0;
      margin: 15px 0;
    }
    
    .tarjeta-producto .stock-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px solid #e2e8f0;
    }
    
    .boton-ver-detalle {
      background: #2b6cb0;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      text-decoration: none;
      display: inline-block;
      font-weight: 500;
      transition: background 0.3s;
    }
    
    .boton-ver-detalle:hover {
      background: #2c5282;
    }
    
    .sin-productos {
      text-align: center;
      padding: 60px 20px;
      color: #718096;
    }
    
    .filtros-busqueda {
      background: white;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 30px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .grupo-filtro {
      display: flex;
      gap: 15px;
      align-items: center;
      flex-wrap: wrap;
    }
    
    .grupo-filtro input,
    .grupo-filtro select {
      flex: 1;
      min-width: 200px;
      padding: 10px 15px;
      border: 1px solid #e2e8f0;
      border-radius: 6px;
      font-size: 1em;
    }
    
    .estadisticas-usuario {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .tarjeta-estadistica-usuario {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      border-radius: 12px;
      text-align: center;
    }
    
    .tarjeta-estadistica-usuario h3 {
      font-size: 0.9em;
      opacity: 0.9;
      margin-bottom: 10px;
    }
    
    .tarjeta-estadistica-usuario .valor {
      font-size: 2em;
      font-weight: bold;
    }
  </style>
</head>
<body>

  <!-- ===== BARRA DE NAVEGACI√ìN ===== -->
  <header class="barra-navegacion">
    <div class="contenedor">
      <h1 class="logo">FerreterIA</h1>
      <nav class="menu">
        <ul class="enlaces">
          <li><a href="../../Index.html">Inicio</a></li>
          <li><a href="dashboard-usuario.html">Cat√°logo</a></li>
          <li><a href="../comunes/acerca-de-nosotros.html">Acerca de</a></li>
        </ul>
      </nav>

      <div class="botones" id="botonesAuth">
        <button class="btn-borde" onclick="location.href='../Login.html'">Iniciar sesi√≥n</button>
        <button class="btn-principal" onclick="location.href='registro.html'">Registrarse</button>
      </div>
    </div>
  </header>

  <!-- ===== SECCI√ìN PRINCIPAL ===== -->
  <section class="seccion-principal" style="margin-top: 80px;">
    <div class="contenido-principal">
      <div class="encabezado-explora">
        <h2>Cat√°logo de Productos üõ†Ô∏è</h2>
        <p>Explora nuestro inventario completo de productos de ferreter√≠a</p>
      </div>

      <!-- Estad√≠sticas -->
      <div class="estadisticas-usuario" id="estadisticas">
        <div class="tarjeta-estadistica-usuario">
          <h3>Total Productos</h3>
          <div class="valor" id="total-productos">0</div>
        </div>
        <div class="tarjeta-estadistica-usuario" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
          <h3>Categor√≠as Disponibles</h3>
          <div class="valor" id="total-categorias">0</div>
        </div>
        <div class="tarjeta-estadistica-usuario" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
          <h3>Productos en Stock</h3>
          <div class="valor" id="productos-stock">0</div>
        </div>
      </div>

      <!-- Filtros y B√∫squeda -->
      <div class="filtros-busqueda">
        <div class="grupo-filtro">
          <input type="text" id="buscar-producto" placeholder="üîç Buscar por nombre o categor√≠a..." />
          <select id="filtro-categoria">
            <option value="">Todas las categor√≠as</option>
          </select>
          <select id="filtro-stock">
            <option value="">Todos los productos</option>
            <option value="disponible">Solo disponibles</option>
            <option value="bajo">Stock bajo</option>
          </select>
        </div>
      </div>

      <!-- Cat√°logo de Productos -->
      <div class="catalogo-productos" id="catalogo-productos">
        <!-- Los productos se cargar√°n aqu√≠ din√°micamente -->
      </div>

      <div class="sin-productos" id="sin-productos" style="display: none;">
        <h3>üîç No se encontraron productos</h3>
        <p>Intenta ajustar tus filtros de b√∫squeda</p>
      </div>
    </div>
  </section>

  <!-- ===== PIE DE P√ÅGINA ===== -->
  <footer class="pie-pagina">
    <div class="contenedor-pie">
      <div>
        <h4>FerreterIA</h4>
        <p>Tu socio de confianza para soluciones seguras y eficientes.</p>
      </div>
      <div>
        <h4>Enlaces r√°pidos</h4>
        <ul>
          <li><a href="../../Index.html">Inicio</a></li>
          <li><a href="../comunes/acerca-de-nosotros.html">Acerca de</a></li>
          <li><a href="dashboard-usuario.html">Cat√°logo</a></li>
        </ul>
      </div>
      <div>
        <h4>Servicios</h4>
        <ul>
          <li>Cat√°logo de productos</li>
          <li>B√∫squeda avanzada</li>
          <li>Informaci√≥n detallada</li>
        </ul>
      </div>
      <div>
        <h4>Cont√°ctanos</h4>
        <p>Email: info@ferreteria.com<br>Tel: 312-XXX-XXXX</p>
      </div>
    </div>
    <p class="copy">&copy; 2025 FerreterIA. Todos los derechos reservados.</p>
  </footer>

  <!-- Scripts -->
  <script src="../../js/utils.js"></script>
  <script src="../../js/productos.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      // Verificar si hay usuario autenticado
      const usuario = verificarAutenticacion();
      if (usuario) {
        actualizarBotonesAuth();
      }
      
      cargarProductos();
      inicializarFiltros();
    });

    function cargarProductos(filtro = {}) {
      const productos = gestorProductos.obtenerTodos();
      const catalogoDiv = document.getElementById('catalogo-productos');
      const sinProductosDiv = document.getElementById('sin-productos');
      
      // Actualizar estad√≠sticas
      const categorias = [...new Set(productos.map(p => p.categoria))];
      const productosConStock = productos.filter(p => p.stock > 0);
      
      document.getElementById('total-productos').textContent = productos.length;
      document.getElementById('total-categorias').textContent = categorias.length;
      document.getElementById('productos-stock').textContent = productosConStock.length;
      
      // Actualizar select de categor√≠as
      const selectCategoria = document.getElementById('filtro-categoria');
      const opcionesActuales = selectCategoria.querySelectorAll('option');
      opcionesActuales.forEach((opt, index) => {
        if (index > 0) opt.remove();
      });
      
      categorias.forEach(cat => {
        const option = document.createElement('option');
        option.value = cat;
        option.textContent = cat;
        selectCategoria.appendChild(option);
      });

      // Filtrar productos
      let productosFiltrados = productos;
      
      if (filtro.texto) {
        const textoLower = filtro.texto.toLowerCase();
        productosFiltrados = productosFiltrados.filter(p => 
          p.nombre.toLowerCase().includes(textoLower) ||
          p.categoria.toLowerCase().includes(textoLower)
        );
      }
      
      if (filtro.categoria) {
        productosFiltrados = productosFiltrados.filter(p => 
          p.categoria === filtro.categoria
        );
      }
      
      if (filtro.stock === 'disponible') {
        productosFiltrados = productosFiltrados.filter(p => p.stock > 0);
      } else if (filtro.stock === 'bajo') {
        productosFiltrados = productosFiltrados.filter(p => p.stock < 5 && p.stock > 0);
      }

      // Renderizar productos
      catalogoDiv.innerHTML = '';
      
      if (productosFiltrados.length === 0) {
        catalogoDiv.style.display = 'none';
        sinProductosDiv.style.display = 'block';
        return;
      }

      catalogoDiv.style.display = 'grid';
      sinProductosDiv.style.display = 'none';

      productosFiltrados.forEach(producto => {
        const estadoStock = gestorProductos.obtenerEstadoStock(producto.stock);
        const precioFormateado = gestorProductos.formatearPrecio(producto.precio);
        
        const tarjeta = document.createElement('div');
        tarjeta.className = 'tarjeta-producto';
        tarjeta.innerHTML = `
          <h3>${sanitizarTexto(producto.nombre)}</h3>
          <div class="categoria">üìÇ ${sanitizarTexto(producto.categoria)}</div>
          <div class="precio">${precioFormateado}</div>
          <div class="stock-info">
            <span class="estado-stock ${estadoStock.clase}">${estadoStock.texto} (${producto.stock} unidades)</span>
            <a href="detalle-producto.html?id=${producto.id}" class="boton-ver-detalle">Ver Detalle</a>
          </div>
        `;
        catalogoDiv.appendChild(tarjeta);
      });
    }

    function inicializarFiltros() {
      const inputBusqueda = document.getElementById('buscar-producto');
      const selectCategoria = document.getElementById('filtro-categoria');
      const selectStock = document.getElementById('filtro-stock');

      function aplicarFiltros() {
        const filtro = {
          texto: inputBusqueda.value.trim(),
          categoria: selectCategoria.value,
          stock: selectStock.value
        };
        cargarProductos(filtro);
      }

      inputBusqueda.addEventListener('input', aplicarFiltros);
      selectCategoria.addEventListener('change', aplicarFiltros);
      selectStock.addEventListener('change', aplicarFiltros);
    }
  </script>
</body>
</html>

